model Employee {
  id                              String                               @id @default(uuid())
  userId                          String?                              @unique
  employeeId                      String                               @unique
  employeeName                    String
  fatherHusbandName               String
  departmentId                    String
  subDepartmentId                 String?
  employeeGradeId                 String
  attendanceId                    String
  designationId                   String
  maritalStatusId                 String?
  employmentStatusId              String?
  probationExpiryDate             DateTime?
  cnicNumber                      String                               @unique
  cnicExpiryDate                  DateTime?
  lifetimeCnic                    Boolean                              @default(false)
  joiningDate                     DateTime?
  dateOfBirth                     DateTime?
  nationality                     String
  gender                          String
  contactNumber                   String
  emergencyContactNumber          String?
  emergencyContactPerson          String?
  personalEmail                   String?
  officialEmail                   String?                              @unique
  countryId                       String
  stateId                         String
  cityId                          String
  area                            String?
  employeeSalary                  Decimal
  eobi                            Boolean                              @default(false)
  eobiId                          String?
  eobiCode                        String?
  eobiNumber                      String?
  eobiDocumentUrl                 String?
  documentUrls                    Json?
  providentFund                   Boolean                              @default(false)
  overtimeApplicable              Boolean                              @default(false)
  daysOff                         String?
  reportingManager                String?
  workingHoursPolicyId            String
  locationId                      String?
  allocationId                    String?
  leavesPolicyId                  String
  allowRemoteAttendance           Boolean                              @default(false)
  currentAddress                  String?
  permanentAddress                String?
  bankName                        String
  accountNumber                   String
  accountTitle                    String
  status                          String                               @default("active")
  isRejoined                      Boolean                              @default(false)
  originalJoiningDate             DateTime?
  lastExitDate                    DateTime?
  rejoinCount                     Int                                  @default(0)
  createdAt                       DateTime                             @default(now())
  updatedAt                       DateTime                             @updatedAt
  advanceSalaries                 AdvanceSalary[]
  allowances                      Allowance[]
  attendances                     Attendance[]
  attendanceExemptions            AttendanceExemption[]
  attendanceRequestQueries        AttendanceRequestQuery[]
  bonuses                         Bonus[]                              @relation("BonusEmployee")
  deductions                      Deduction[]
  departmentAsHead                Department?                          @relation("DepartmentHead")
  allocation                      Allocation?                          @relation(fields: [allocationId], references: [id], onDelete: Restrict)
  city                            City                                 @relation(fields: [cityId], references: [id])
  country                         Country                              @relation(fields: [countryId], references: [id])
  department                      Department                           @relation(fields: [departmentId], references: [id])
  designation                     Designation                          @relation(fields: [designationId], references: [id])
  employeeGrade                   EmployeeGrade                        @relation(fields: [employeeGradeId], references: [id])
  employmentStatus                EmployeeStatus?                      @relation(fields: [employmentStatusId], references: [id], onDelete: Restrict)
  leavesPolicy                    LeavesPolicy                         @relation(fields: [leavesPolicyId], references: [id])
  location                        Location?                            @relation(fields: [locationId], references: [id], onDelete: Restrict)
  maritalStatus                   MaritalStatus?                       @relation(fields: [maritalStatusId], references: [id], onDelete: Restrict)
  state                           State                                @relation(fields: [stateId], references: [id])
  subDepartment                   SubDepartment?                       @relation(fields: [subDepartmentId], references: [id])
  user                            User?                                @relation(fields: [userId], references: [id], onDelete: Cascade)
  workingHoursPolicy              WorkingHoursPolicy                   @relation(fields: [workingHoursPolicyId], references: [id])
  equipmentAssignments            EmployeeEquipment[]
  qualifications                  EmployeeQualification[]
  rejoiningHistory                EmployeeRejoiningHistory[]
  exitClearances                  ExitClearance[]
  increments                      Increment[]                          @relation("IncrementEmployee")
  leaveApplications               LeaveApplication[]
  leaveEncashments                LeaveEncashment[]
  loanRequests                    LoanRequest[]
  overtimeRequests                OvertimeRequest[]                    @relation("OvertimeRequestEmployee")
  pfWithdrawals                   PFWithdrawal[]
  payrollDetails                  PayrollDetail[]
  rebates                         Rebate[]
  requestForwardingApprovalLevels RequestForwardingApprovalLevel[]     @relation("RequestForwardingSpecificEmployee")
  socialSecurityContributions     SocialSecurityContribution[]
  socialSecurityRegistrations     SocialSecurityEmployeeRegistration[]
  subDepartmentAsHead             SubDepartment?                       @relation("SubDepartmentHead")
  policyAssignments               WorkingHoursPolicyAssignment[]
}

model EmployeeRejoiningHistory {
  id                    String   @id @default(uuid())
  employeeId            String
  previousEmployeeId    String
  newEmployeeId         String
  previousAttendanceId  String
  newAttendanceId       String
  previousExitDate      DateTime
  rejoiningDate         DateTime
  previousDepartmentId  String?
  newDepartmentId       String?
  previousDesignationId String?
  newDesignationId      String?
  previousSalary        Decimal?
  newSalary             Decimal?
  previousValues        Json?
  newValues             Json?
  changedFields         Json?
  remarks               String?
  createdById           String?
  createdAt             DateTime @default(now())
  createdBy             User?    @relation(fields: [createdById], references: [id])
  employee              Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([rejoiningDate])
}

model EmployeeQualification {
  id              String        @id @default(uuid())
  employeeId      String
  qualificationId String
  instituteId     String?
  cityId          String?
  stateId         String?
  year            Int?
  grade           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  city            City?         @relation(fields: [cityId], references: [id])
  employee        Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  institute       Institute?    @relation(fields: [instituteId], references: [id])
  qualification   Qualification @relation(fields: [qualificationId], references: [id])
  state           State?        @relation(fields: [stateId], references: [id])

  @@index([employeeId])
}

model EmployeeEquipment {
  id           String    @id @default(uuid())
  employeeId   String
  equipmentId  String
  productId    String
  assignedDate DateTime  @default(now())
  returnedDate DateTime?
  status       String    @default("assigned")
  notes        String?
  metadata     Json?
  assignedById String?
  returnedById String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  assignedBy   User?     @relation("EquipmentAssignedBy", fields: [assignedById], references: [id])
  employee     Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  equipment    Equipment @relation(fields: [equipmentId], references: [id])
  returnedBy   User?     @relation("EquipmentReturnedBy", fields: [returnedById], references: [id])

  @@index([employeeId])
  @@index([equipmentId])
  @@index([status])
  @@index([productId])
}
