model SocialSecurityInstitution {
  id                    String                               @id @default(uuid())
  code                  String                               @unique
  name                  String                               @unique
  province              String?
  description           String?
  status                String                               @default("active")
  website               String?
  contactNumber         String?
  address               String?
  contributionRate      Decimal                              @default(0) @db.Decimal(5, 2)
  createdAt             DateTime                             @default(now())
  updatedAt             DateTime                             @updatedAt
  createdById           String?
  updatedById           String?
  contributions         SocialSecurityContribution[]
  employeeRegistrations SocialSecurityEmployeeRegistration[]
  employerRegistrations SocialSecurityEmployerRegistration[]
  employees             Employee[]
  createdBy             User?                                @relation("SocialSecurityInstitutionCreatedBy", fields: [createdById], references: [id])
  updatedBy             User?                                @relation("SocialSecurityInstitutionUpdatedBy", fields: [updatedById], references: [id])

  @@index([code])
  @@index([status])
}

model SocialSecurityEmployerRegistration {
  id                    String                               @id @default(uuid())
  institutionId         String
  registrationNumber    String                               @unique
  employerName          String
  employerType          String
  businessAddress       String
  businessCity          String?
  businessState         String?
  businessCountry       String?
  contactPerson         String?
  contactNumber         String?
  email                 String?
  registrationDate      DateTime
  expiryDate            DateTime?
  status                String                               @default("active")
  totalEmployees        Int                                  @default(0)
  monthlyContribution   Decimal?                             @db.Decimal(10, 2)
  notes                 String?
  documentUrls          Json?
  createdAt             DateTime                             @default(now())
  updatedAt             DateTime                             @updatedAt
  createdById           String?
  updatedById           String?
  contributions         SocialSecurityContribution[]
  employeeRegistrations SocialSecurityEmployeeRegistration[]
  createdBy             User?                                @relation("SocialSecurityEmployerRegistrationCreatedBy", fields: [createdById], references: [id])
  institution           SocialSecurityInstitution            @relation(fields: [institutionId], references: [id])
  updatedBy             User?                                @relation("SocialSecurityEmployerRegistrationUpdatedBy", fields: [updatedById], references: [id])

  @@index([institutionId])
  @@index([registrationNumber])
  @@index([status])
  @@index([registrationDate])
}

model SocialSecurityEmployeeRegistration {
  id                     String                             @id @default(uuid())
  institutionId          String
  employerRegistrationId String
  employeeId             String
  registrationNumber     String                             @unique
  cardNumber             String?                            @unique
  registrationDate       DateTime
  expiryDate             DateTime?
  status                 String                             @default("active")
  contributionRate       Decimal                            @db.Decimal(5, 2)
  baseSalary             Decimal                            @db.Decimal(10, 2)
  monthlyContribution    Decimal                            @db.Decimal(10, 2)
  isEmployerContribution Boolean                            @default(true)
  employeeContribution   Decimal?                           @db.Decimal(10, 2)
  employerContribution   Decimal?                           @db.Decimal(10, 2)
  cardIssueDate          DateTime?
  cardExpiryDate         DateTime?
  cardStatus             String?
  documentUrls           Json?
  notes                  String?
  createdAt              DateTime                           @default(now())
  updatedAt              DateTime                           @updatedAt
  createdById            String?
  updatedById            String?
  contributions          SocialSecurityContribution[]
  createdBy              User?                              @relation("SocialSecurityEmployeeRegistrationCreatedBy", fields: [createdById], references: [id])
  employee               Employee                           @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employerRegistration   SocialSecurityEmployerRegistration @relation(fields: [employerRegistrationId], references: [id])
  institution            SocialSecurityInstitution          @relation(fields: [institutionId], references: [id])
  updatedBy              User?                              @relation("SocialSecurityEmployeeRegistrationUpdatedBy", fields: [updatedById], references: [id])

  @@unique([institutionId, employeeId])
  @@index([institutionId])
  @@index([employerRegistrationId])
  @@index([employeeId])
  @@index([registrationNumber])
  @@index([cardNumber])
  @@index([status])
  @@index([registrationDate])
}

model SocialSecurityContribution {
  id                     String                             @id @default(uuid())
  institutionId          String
  employerRegistrationId String
  employeeRegistrationId String
  employeeId             String
  month                  String
  year                   String
  date                   DateTime
  baseSalary             Decimal                            @db.Decimal(10, 2)
  contributionRate       Decimal                            @db.Decimal(5, 2)
  contributionAmount     Decimal                            @db.Decimal(10, 2)
  employeeContribution   Decimal?                           @db.Decimal(10, 2)
  employerContribution   Decimal?                           @db.Decimal(10, 2)
  paymentStatus          String                             @default("pending")
  paymentDate            DateTime?
  paymentReference       String?
  dueDate                DateTime?
  lateFee                Decimal?                           @db.Decimal(10, 2)
  notes                  String?
  status                 String                             @default("active")
  createdAt              DateTime                           @default(now())
  updatedAt              DateTime                           @updatedAt
  payrollDetailId        String?
  createdById            String?
  updatedById            String?
  createdBy              User?                              @relation("SocialSecurityContributionCreatedBy", fields: [createdById], references: [id])
  employee               Employee                           @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeRegistration   SocialSecurityEmployeeRegistration @relation(fields: [employeeRegistrationId], references: [id])
  employerRegistration   SocialSecurityEmployerRegistration @relation(fields: [employerRegistrationId], references: [id])
  institution            SocialSecurityInstitution          @relation(fields: [institutionId], references: [id])
  payrollDetail          PayrollDetail?                     @relation(fields: [payrollDetailId], references: [id])
  updatedBy              User?                              @relation("SocialSecurityContributionUpdatedBy", fields: [updatedById], references: [id])

  @@unique([institutionId, employeeRegistrationId, month, year])
  @@index([institutionId])
  @@index([employerRegistrationId])
  @@index([employeeRegistrationId])
  @@index([employeeId])
  @@index([month, year])
  @@index([paymentStatus])
  @@index([status])
  @@index([payrollDetailId])
}
