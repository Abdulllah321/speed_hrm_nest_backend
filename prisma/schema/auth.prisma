model User {
  id                                         String                               @id @default(uuid())
  email                                      String                               @unique
  password                                   String
  firstName                                  String
  lastName                                   String
  phone                                      String?
  avatar                                     String?
  employeeId                                 String?                              @unique
  status                                     String                               @default("active")
  failedLoginAttempts                        Int                                  @default(0)
  lockedUntil                                DateTime?
  lastLoginAt                                DateTime?
  lastLoginIp                                String?
  passwordChangedAt                          DateTime?
  mustChangePassword                         Boolean                              @default(false)
  isFirstPassword                            Boolean                              @default(true)
  createdAt                                  DateTime                             @default(now())
  updatedAt                                  DateTime                             @updatedAt
  roleId                                     String?
  activityLogs                               ActivityLog[]
  advanceSalariesApproved                    AdvanceSalary[]                      @relation("AdvanceSalaryApprovedBy")
  advanceSalariesCreated                     AdvanceSalary[]                      @relation("AdvanceSalaryCreatedBy")
  advanceSalariesUpdated                     AdvanceSalary[]                      @relation("AdvanceSalaryUpdatedBy")
  allocationsCreated                         Allocation[]                         @relation("AllocationCreatedBy")
  allowancesCreated                          Allowance[]                          @relation("AllowanceCreatedBy")
  allowancesUpdated                          Allowance[]                          @relation("AllowanceUpdatedBy")
  allowanceHeadsCreated                      AllowanceHead[]                      @relation("AllowanceHeadCreatedBy")
  approvalSettingsCreated                    ApprovalSetting[]                    @relation("ApprovalSettingCreatedBy")
  attendancesCreated                         Attendance[]                         @relation("AttendanceCreatedBy")
  attendancesUpdated                         Attendance[]                         @relation("AttendanceUpdatedBy")
  attendanceExemptionsCreated                AttendanceExemption[]                @relation("AttendanceExemptionCreatedBy")
  attendanceExemptionsUpdated                AttendanceExemption[]                @relation("AttendanceExemptionUpdatedBy")
  banksCreated                               Bank[]                               @relation("BankCreatedBy")
  banksUpdated                               Bank[]                               @relation("BankUpdatedBy")
  chartOfAccountsCreated                     ChartOfAccount[]                     @relation("ChartOfAccountCreatedBy")
  bonuses                                    Bonus[]                              @relation("BonusCreatedBy")
  bonusesUpdated                             Bonus[]                              @relation("BonusUpdatedBy")
  bonusTypesCreated                          BonusType[]                          @relation("BonusTypeCreatedBy")
  citiesCreated                              City[]                               @relation("CityCreatedBy")
  deductionsCreated                          Deduction[]                          @relation("DeductionCreatedBy")
  deductionsUpdated                          Deduction[]                          @relation("DeductionUpdatedBy")
  deductionHeadsCreated                      DeductionHead[]                      @relation("DeductionHeadCreatedBy")
  degreeTypesCreated                         DegreeType[]                         @relation("DegreeTypeCreatedBy")
  departmentsCreated                         Department[]                         @relation("DepartmentCreatedBy")
  designationsCreated                        Designation[]                        @relation("DesignationCreatedBy")
  eobisCreated                               EOBI[]                               @relation("EOBICreatedBy")
  employee                                   Employee?
  equipmentAssigned                          EmployeeEquipment[]                  @relation("EquipmentAssignedBy")
  equipmentReturned                          EmployeeEquipment[]                  @relation("EquipmentReturnedBy")
  employeeGradesCreated                      EmployeeGrade[]                      @relation("EmployeeGradeCreatedBy")
  rejoiningHistoryCreated                    EmployeeRejoiningHistory[]
  employeeStatusesCreated                    EmployeeStatus[]                     @relation("EmployeeStatusCreatedBy")
  equipmentsCreated                          Equipment[]                          @relation("EquipmentCreatedBy")
  fileUploadsCreated                         FileUpload[]                         @relation("FileUploadCreatedBy")
  holidaysCreated                            Holiday[]                            @relation("HolidayCreatedBy")
  incrementsCreated                          Increment[]                          @relation("IncrementCreatedBy")
  incrementsUpdated                          Increment[]                          @relation("IncrementUpdatedBy")
  institutesCreated                          Institute[]                          @relation("InstituteCreatedBy")
  jobTypesCreated                            JobType[]                            @relation("JobTypeCreatedBy")
  leaveApplicationsCreated                   LeaveApplication[]                   @relation("LeaveApplicationCreatedBy")
  leaveApplicationsUpdated                   LeaveApplication[]                   @relation("LeaveApplicationUpdatedBy")
  leaveEncashmentsApproved                   LeaveEncashment[]                    @relation("LeaveEncashmentApprovedBy")
  leaveEncashmentsCreated                    LeaveEncashment[]                    @relation("LeaveEncashmentCreatedBy")
  leaveEncashmentsUpdated                    LeaveEncashment[]                    @relation("LeaveEncashmentUpdatedBy")
  leaveTypesCreated                          LeaveType[]                          @relation("LeaveTypeCreatedBy")
  leavesPoliciesCreated                      LeavesPolicy[]                       @relation("LeavesPolicyCreatedBy")
  loanRequestsApproved                       LoanRequest[]                        @relation("LoanRequestApprovedBy")
  loanRequestsCreated                        LoanRequest[]                        @relation("LoanRequestCreatedBy")
  loanRequestsUpdated                        LoanRequest[]                        @relation("LoanRequestUpdatedBy")
  loanTypesCreated                           LoanType[]                           @relation("LoanTypeCreatedBy")
  locationsCreated                           Location[]                           @relation("LocationCreatedBy")
  loginHistory                               LoginHistory[]
  maritalStatusesCreated                     MaritalStatus[]                      @relation("MaritalStatusCreatedBy")
  overtimeRequestsCreated                    OvertimeRequest[]                    @relation("OvertimeRequestCreatedBy")
  overtimeRequestsUpdated                    OvertimeRequest[]                    @relation("OvertimeRequestUpdatedBy")
  pfWithdrawalsApproved                      PFWithdrawal[]                       @relation("PFWithdrawalApprovedBy")
  pfWithdrawalsCreated                       PFWithdrawal[]                       @relation("PFWithdrawalCreatedBy")
  pfWithdrawalsUpdated                       PFWithdrawal[]                       @relation("PFWithdrawalUpdatedBy")
  payrollsGenerated                          Payroll[]                            @relation("PayrollGeneratedBy")
  providentFundsCreated                      ProvidentFund[]                      @relation("ProvidentFundCreatedBy")
  qualificationsCreated                      Qualification[]                      @relation("QualificationCreatedBy")
  rebalesCreated                             Rebate[]                             @relation("RebateCreatedBy")
  rebateNaturesCreated                       RebateNature[]                       @relation("RebateNatureCreatedBy")
  refreshTokens                              RefreshToken[]
  requestForwardingConfigsCreated            RequestForwardingConfiguration[]     @relation("RequestForwardingConfigCreatedBy")
  requestForwardingConfigsUpdated            RequestForwardingConfiguration[]     @relation("RequestForwardingConfigUpdatedBy")
  salaryBreakupsCreated                      SalaryBreakup[]                      @relation("SalaryBreakupCreatedBy")
  sessions                                   Session[]
  socialSecurityContributionsCreated         SocialSecurityContribution[]         @relation("SocialSecurityContributionCreatedBy")
  socialSecurityContributionsUpdated         SocialSecurityContribution[]         @relation("SocialSecurityContributionUpdatedBy")
  socialSecurityEmployeeRegistrationsCreated SocialSecurityEmployeeRegistration[] @relation("SocialSecurityEmployeeRegistrationCreatedBy")
  socialSecurityEmployeeRegistrationsUpdated SocialSecurityEmployeeRegistration[] @relation("SocialSecurityEmployeeRegistrationUpdatedBy")
  socialSecurityEmployerRegistrationsCreated SocialSecurityEmployerRegistration[] @relation("SocialSecurityEmployerRegistrationCreatedBy")
  socialSecurityEmployerRegistrationsUpdated SocialSecurityEmployerRegistration[] @relation("SocialSecurityEmployerRegistrationUpdatedBy")
  socialSecurityInstitutionsCreated          SocialSecurityInstitution[]          @relation("SocialSecurityInstitutionCreatedBy")
  socialSecurityInstitutionsUpdated          SocialSecurityInstitution[]          @relation("SocialSecurityInstitutionUpdatedBy")
  statesCreated                              State[]                              @relation("StateCreatedBy")
  subDepartmentsCreated                      SubDepartment[]                      @relation("SubDepartmentCreatedBy")
  taxSlabsCreated                            TaxSlab[]                            @relation("TaxSlabCreatedBy")
  role                                       Role?                                @relation(fields: [roleId], references: [id])
  preferences                                UserPreference[]
  notifications                              Notification[]
  workingHoursPoliciesCreated                WorkingHoursPolicy[]                 @relation("WorkingHoursPolicyCreatedBy")
  policyAssignmentsCreated                   WorkingHoursPolicyAssignment[]       @relation("PolicyAssignmentCreatedBy")
  payrollApprovalRequestsCreated             PayrollApprovalRequest[]             @relation("PayrollApprovalRequestCreatedBy")
  payrollApprovalRequestsUpdated             PayrollApprovalRequest[]             @relation("PayrollApprovalRequestUpdatedBy")
  payrollApprovalLevelAssignments            PayrollApprovalLevel[]               @relation("PayrollApprovalLevelAssignedApprover")
  payrollApprovalLevelsApproved              PayrollApprovalLevel[]               @relation("PayrollApprovalLevelApprovedBy")
  payrollApprovalHistoryPerformed            PayrollApprovalHistory[]             @relation("PayrollApprovalHistoryPerformedBy")
  transferHistoryCreated                     EmployeeTransferHistory[]            @relation("TransferHistoryCreatedBy")
}

model Role {
  id          String           @id @default(uuid())
  name        String           @unique
  description String?
  isSystem    Boolean          @default(false)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  permissions RolePermission[]
  users       User[]
}

model Permission {
  id          String           @id @default(uuid())
  name        String           @unique
  module      String
  action      String
  description String?
  createdAt   DateTime         @default(now())
  roles       RolePermission[]
}

model RolePermission {
  id           String     @id @default(uuid())
  roleId       String
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
}

model Session {
  id             String   @id @default(uuid())
  userId         String
  token          String   @unique
  ipAddress      String?
  userAgent      String?
  deviceInfo     String?
  isActive       Boolean  @default(true)
  expiresAt      DateTime
  createdAt      DateTime @default(now())
  lastActivityAt DateTime @default(now())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  family    String
  isRevoked Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

model ActivityLog {
  id           String   @id @default(uuid())
  userId       String?
  action       String
  module       String?
  entity       String?
  entityId     String?
  description  String?
  oldValues    String?
  newValues    String?
  ipAddress    String?
  userAgent    String?
  status       String   @default("success")
  errorMessage String?
  metadata     String?
  createdAt    DateTime @default(now())
  user         User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([module])
  @@index([createdAt])
}

model LoginHistory {
  id         String   @id @default(uuid())
  userId     String
  ipAddress  String
  userAgent  String?
  deviceInfo String?
  status     String
  failReason String?
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model BlacklistedToken {
  id        String   @id @default(uuid())
  token     String   @unique
  reason    String?
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([token])
}

model UserPreference {
  id        String   @id @default(uuid())
  userId    String
  key       String
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, key])
  @@index([userId])
  @@index([key])
}

model Notification {
  id               String                        @id @default(uuid())
  userId           String
  title            String
  message          String
  category         String                        @default("general")
  priority         String                        @default("normal")
  status           String                        @default("unread")
  actionType       String?
  actionPayload    String?
  entityType       String?
  entityId         String?
  deliveryChannels String                        @default("inApp")
  readAt           DateTime?
  deliveredAt      DateTime?
  createdAt        DateTime                      @default(now())
  updatedAt        DateTime                      @updatedAt
  user             User                          @relation(fields: [userId], references: [id], onDelete: Cascade)
  deliveryAttempts NotificationDeliveryAttempt[]

  @@index([userId])
  @@index([status])
  @@index([category])
  @@index([priority])
  @@index([createdAt])
  @@index([entityType, entityId])
}

model NotificationDeliveryAttempt {
  id             String       @id @default(uuid())
  notificationId String
  channel        String
  status         String       @default("pending")
  attempt        Int          @default(0)
  nextAttemptAt  DateTime?
  errorMessage   String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  @@index([notificationId])
  @@index([status])
  @@index([channel])
  @@index([nextAttemptAt])
}
